import com.github.jengelman.gradle.plugins.shadow.tasks.ShadowJar

plugins {
    id 'java'
    id 'com.github.johnrengelman.shadow' version '8.1.1'
    id 'com.github.jk1.dependency-license-report' version '2.9'
}

group = 'com.github.brickwall2900'
version = '1.5.0'

repositories {
    mavenCentral()
}

dependencies {
    testImplementation platform('org.junit:junit-bom:5.10.0')
    testImplementation 'org.junit.jupiter:junit-jupiter'

    implementation 'org.httprpc:sierra:2.7.5'
    implementation 'com.google.code.gson:gson:2.13.1'
    implementation 'com.formdev:flatlaf:3.6'

    implementation 'com.dorkbox:SystemTray:4.4'
}

test {
    useJUnitPlatform()
}

tasks.register('fatJar', ShadowJar) {
    archiveBaseName.set('BirthdayReminder')
    archiveClassifier.set('')
    archiveVersion.set(version.toString())

    manifest {
        attributes 'Main-Class': 'com.github.brickwall2900.birthdays.Main'  // Set your main class
    }

    from(sourceSets.main.output)

    configurations = [project.configurations.runtimeClasspath]
}

tasks.register('generateVersionInfo', JavaCompile) {
    File versionPropsFile = new File(sourceSets.main.output.resourcesDir, "version.properties")
    versionPropsFile.parentFile.mkdirs()
    versionPropsFile.withWriter { writer ->
        Properties props = new Properties()
        props.setProperty("app.version", project.version.toString())
        props.store(writer, "Generated by Gradle build")
    }
}

processResources {
    dependsOn generateVersionInfo
}